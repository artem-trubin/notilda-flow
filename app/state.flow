import app/user;
import app/note;
import app/page;
import app/utils;

export {
  State(
    userB : DynamicBehaviour<User>,
    usersB : DynamicBehaviour<[User]>,
    notesB : DynamicBehaviour<[Note]>,
    currentNoteMB : DynamicBehaviour<Maybe<Note>>,
    currentPageB : DynamicBehaviour<PageType>,
  );

  makeInitialState() -> State;
}

State(
  userB : DynamicBehaviour<User>,
  usersB : DynamicBehaviour<[User]>,
  notesB : DynamicBehaviour<[Note]>,
  currentNoteMB : DynamicBehaviour<Maybe<Note>>,
  currentPageB : DynamicBehaviour<PageType>,
);

makeInitialState() -> State {
  initialPage = PageTypeLogin();

  state = State(
    make(makeDefaultUser()),
    make([]),
    make([]),
    make(None()),
    make(initialPage)
  );

  mockTextForNotes = [
    "Test note",
    "Second test note",
    "Third super ttest note",
  ];

  next(
    state.notesB,
    map(mockTextForNotes, \noteText -> Note(generateId(), noteText))
  );

  mockUsers = [
    User("1", "testUser", "test"),
    User("2", "123", "123"),
  ];
  next(state.usersB, mockUsers);

  state;
}
