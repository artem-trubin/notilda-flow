import app/globals;
import app/note/note;
import app/note/note_helpers;
import app/state/state;
import app/view/view;

export {
  makeViewEditor(
    state : NotildaState,
  ) -> Material;
}

makeViewEditor(
  state : NotildaState,
) -> Material {
  MSelect(state.currentNoteB, \note -> {
    noteTitleB = make(note.title);
    noteTextB = make(note.text);
    expander = MFixedY(16.0);

    saveNote = \ -> {
      addOrUpdateNote(
        state,
        Note(
          note with
          title = getValue(noteTitleB),
          text = getValue(noteTextB)
        )
      );
      resetCurrentNote(state);
      nextDistinct(state.currentViewB, ViewList());
    }

    viewTitle = MText(
      "Note" + if (debugOn) formatString(" [%1]", [note.id]) else "",
      []
    );

    titleInput = MTextInput(
      noteTitleB,
      [
        MOutlined(),
      ],
      [],
    );

    textInput = MTextInput(
      noteTextB,
      [
        Multiline(true),
        MMaxLines(10),
        MOutlined(),
      ],
      []
    );

    saveButton = MTextButton("SAVE", saveNote, [], []);
    buttonsBlock = MColsA([
      MFillX(),
      saveButton,
    ]);

    MBorder4(
      16.0,
      MLinesA([
        viewTitle,
        expander,
        titleInput,
        expander,
        textInput,
        expander,
        buttonsBlock,
      ])
    );
  });
}
