import material/material;

import src/notes;
import src/fab;
import src/state;

export {
  makeApp(state : State) -> Material;
}

makeHeader(
  manager : MaterialManager,
  sideNavExpander : DynamicBehaviour<bool>
) -> MAppBar {
  title = MText("Notilda", []);
  rightElems = [];
  style = [
    makeFab(manager)
  ];

  toolBar = MToolbar(sideNavExpander, title, rightElems, style);

  MAppBar(toolBar);
}

makeSideNav(sideNavExpander : DynamicBehaviour<bool>) -> MLeftNav {
  header = MSNSmallHead([MText("This is side nav", [])]);
  list = MText("This will be list", []);
  style = [];

  content = MSideNav(header, list, sideNavExpander, style);

  MLeftNav(content, sideNavExpander, [])
}

makeApp(state : State) -> Material {
  mockTextForNotes = [
    "Test note",
    "Second test note",
    "Third super test note",
  ];

  addNoteToState = \note -> {
    dynArrayPush(state.notesB, note)
  };

  iter(mockTextForNotes, \text -> {
    addNote(text, addNoteToState)
  });

  sideNavExpander = make(false);

  header = makeHeader(state.manager, sideNavExpander);
  sideNav = makeSideNav(sideNavExpander);

  content = MContent(MSelect(state.notesB, \notes -> {
    MLines(map(notes, \note -> makeNoteCard(note)))
  }));

  MAppStructure([header, sideNav, content], []);
}
